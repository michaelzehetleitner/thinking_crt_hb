2025-12-11T00:00:00Z | Init preprocessing pipeline | Created targets skeleton (`_targets.R`), helper functions (`R/read_data.R`, `R/make_dfsummary.R`) to load SAV and render dfSummary HTML; added README and TODO, converted prereg PDF to TXT for reference.
2025-12-11T00:00:00Z | Fix dfSummary temp dir | Adjusted `make_dfsummary_html()` to use a short working-dir image folder (`img`) to satisfy summarytools `tmp.img.dir` constraint.
2025-12-11T00:00:00Z | Swap dfSummary render call | Replaced deprecated `summarytools::print(..., method = 'render')` with `summarytools::view()` to avoid namespace error.
2025-12-11T00:00:00Z | Filter to 2025-12-11 | Added `filter_by_recorded_date()` and updated `_targets.R` to keep only responses recorded on 2025-12-11 before generating dfSummary; updated README/TODO accordingly.
2025-12-11T00:00:00Z | Add item metadata JSON | Added `extract_crt_hb_metadata()` and a targets step to write `outputs/hb_crt_items.json` containing CRT/HB item text and response options; updated README/TODO.
2025-12-11T00:00:00Z | Improve item metadata | Excluded timing fields from item metadata and now preserve value/label pairs for Likert options in `outputs/hb_crt_items.json`.
2025-12-11T00:00:00Z | Add answer key template | Added `write_answer_key_template()` and targets step to write `data/hb_crt_answer_key_template.json` for manual completion of correct responses.
2025-12-11T00:00:00Z | Finalize pipeline scaffolding | Renamed answer key to `data/hb_crt_answer_key.json`; rebuilt `_targets.R` to read the key, apply inclusion criteria, score CTSQ/CRT/HB, compute SES/timings, and export `outputs/analysis_dataset.csv`; added scoring/helper functions (`score_ctsq.R`, `score_crt_hb.R`, `compute_ses.R`, `compute_timings.R`, `read_answer_key.R`, `filter_sample.R`); updated README/TODO.
2025-12-11T00:00:00Z | Aid and drop logic | Added hilfsmittel-based item drops, seen-based CRT drops, participant removal when both CRT/HB lost; added drop summary target and helper functions (`apply_drop_logic.R`, `drop_summary.R`); fixed answer-key reader and pipeline wiring; updated README.
2025-12-11T00:00:00Z | Switch to latest SAV | Updated `_targets.R` input to `data/4-CTSQ-D+Follow+Up_December+11,+2025_03.49.sav`.
2025-12-11T00:00:00Z | Export drop summary | Added target to write `outputs/drop_summary.csv`; updated README.
2025-12-11T00:00:00Z | Harden CTSQ scoring | Made CTSQ scoring robust to missing items/columns to avoid NA logical errors.
2025-12-11T00:00:00Z | Fix CRT seen logic | Simplified hilfsmittel detection and restored seen counts to resolve pipeline errors.
2025-12-11T00:00:00Z | Add test plan | Added `tests/TEST_PLAN.md` documenting intended test coverage.
2025-12-11T00:00:00Z | Remove date filter | Updated `_targets.R` to drop the RecordedDate filter (now uses all records with workflow completed and age ≥ 18); README updated.
2025-12-11T00:00:00Z | CRT seen plot | Added target to render `outputs/crt_seen_reasons.png` stacked by reason (seen, aids, other missing).
2025-12-11T00:00:00Z | Fix CRT/HB regex | Broadened regex for crt/hb _num columns (handles item names with underscores) to ensure items_scored counts correctly.
2025-12-11T00:00:00Z | Export all value labels | Added `value_labels_json` target to write `outputs/value_labels.json` (all variables' value/label pairs).
2025-12-11T00:00:00Z | Per-item CRT plot | Updated plot to show per-item stacked bars (scored/seen/hilfsmittel); added ggplot2 to pipeline deps.
2025-12-11T12:00:00Z | Data-driven CTSQ scoring, timing/SES fixes, tests | Refactored `R/score_ctsq.R` to derive subscales/items and numeric coding from data labels (no hard-coded maps), tightened timing regex for `_Page_Submit`, hardened SES against zero/NA household size; added testthat tests for timings, SES, and CTSQ scoring; aligned README/TODO with current input/filter.
2025-12-11T12:15:00Z | Test helper for sourcing functions | Added `tests/testthat/helper-load_functions.R` to source project R scripts so testthat::test_dir finds scoring/helper functions.
2025-12-11T12:30:00Z | Centralize item helpers, reduce grep | Added `R/item_helpers.R` (item lists, seen/aid/timing helpers), refactored `score_crt`, `score_hb`, and `compute_timings` to use helper functions and tidyselect; attempted tests but blocked by missing `rlang` dependency.
2025-12-11T12:40:00Z | Apply item helpers to CTSQ | Updated `score_ctsq` to use `ctsq_items()` helper (no regex lists), keeping data-driven numeric conversion; journal updated.
2025-12-11T12:45:00Z | Tidy subscale means | Replaced base loop in `score_ctsq` with tidyverse mutate/rowMeans using split subscale groups.
2025-12-11T12:55:00Z | Long/tidy CTSQ scoring, add tidyr dep | Reworked `score_ctsq` to pivot long, compute numeric responses, summarise subscale means, and pivot wide; added tidyr to targets packages and README.
2025-12-12T06:21:15Z | Track subscale averaging review | Logged cross-repo averaging review in `TODO.md`, noting completed analyses and the remaining decision about extracting a generic helper.
2025-12-12T10:16:53Z | Simplify CTSQ z-scoring | Streamlined `score_ctsq()` to keep only the four CTSQ subscales, compute av/z with a tidy pipeline, and retain `scaled:center`/`scaled:scale` attributes on z columns; added a test to confirm attributes persist.
2025-12-12T10:50:00Z | Trim export columns & timings | Added `prepare_analysis_export()` to drop raw CTSQ/demo fields, keep only Page_Submit timings, and pipe it into `_targets.R` export; pruned timing helper to remove redundant click-time fields.
2025-12-12T11:20:00Z | Fix tests after tidyselect/z-name changes | Fixed `compute_timings()` tidyselect use and renamed CTSQ z-columns to `ctsq_<subscale>_z` so testthat expectations match.
2025-12-12T11:40:00Z | Align CTSQ tests to z naming | Updated `test_score_ctsq` to look for `ctsq_<subscale>_z` and ignore attributes in value comparisons while still asserting `scaled:center/scale`.
2025-12-12T16:25:00Z | Start prereg compliance hardening | Added prereg exclusion helper (consent/aid), piped it into `_targets.R`, introduced export validation, created prereg-aligned column aliases and demographic z-scores in `prepare_analysis_export()`, expanded drop summary, and kept SES in the final CSV; documented task updates in TODO.
2025-12-12T17:00:00Z | Fix export validation | Relaxed `validate_export()` to treat NA as allowable (still blocks Inf/NaN), after tar_make failed on CRT_z NA values.
2025-12-12T18:00:00Z | Add prereg tests | Added testthat coverage for prereg exclusions, CRT familiarity drops, export validation/aliases; updated TODO status accordingly.
2025-12-12T18:20:00Z | Fix test sourcing | Adjusted helper to source R/ functions relative to tests/testthat; added CRT/HB aid/outcome-bias tests; updated TODO.
2025-12-12T18:30:00Z | Robust helper sourcing | Simplified test helper to sys.source all R/ files to ensure functions are visible in testthat runs (addresses RStudio test_dir failures).
2025-12-12T18:45:00Z | Drop CTSQ raw columns reliably | Hardened `prepare_analysis_export()` to always strip remaining `CTSQ_*` columns (post-select safety filter) after prereg aliasing, addressing test failure.
2025-12-12T18:55:00Z | Remove duplicate export columns | Dropped all `ctsq_*` working columns and lowercase `crt_/hb_` dupes from the export, keeping only prereg/JASP-aligned aliases and needed covariates.
2025-12-12T19:10:00Z | Range/shape tests | Added tests to block out-of-range CRT/HB proportions and to ensure CRT per-item numeric columns match the answer key; TODO updated.
2025-12-12T19:20:00Z | Execution reminders | Added TODO note with the R commands the user should run locally (`tar_make`, `testthat::test_dir` with `RENV_CONFIG_AUTOLOAD=FALSE`) since Rscript runs are handed off due to renv/sandbox constraints.
2025-12-12T19:35:00Z | analysis.csv tests | Added testthat checks for final CSV: required columns present, no CTSQ/duplicate CRT/HB fields, proportions in [0,1], and CRT per-item columns match answer key; updated TODO.
2025-12-12T19:55:00Z | Sanity outputs target | Added optional `make_sanity_outputs()` target to write quick histograms (CRT/HB proportions, CTSQ z-scores) and copy drop summary into `outputs/sanity/`; linked into `_targets.R`.
2025-12-12T20:05:00Z | Final CTSQ drop safety | Reintroduced a post-select safety filter in `prepare_analysis_export()` to forcibly remove any lingering `CTSQ_*` columns (fixing failing prereg/export test).
2025-12-12T20:20:00Z | Whitelist export columns | Switched `prepare_analysis_export()` to a whitelist: keep prereg/JASP vars, QA flags, Duration__in_seconds_, ResponseId/respondiID, all pol_* and demo_* raw fields, SES components; drop everything else.
2025-12-12T20:30:00Z | Per-item correctness summaries | Added `summarise_crt_hb_items()` to write per-item correct/incorrect/NA tables for CRT/HB into `outputs/sanity/` and wired it into the sanity target.
2025-12-12T20:40:00Z | Silence tidyselect warning | Adjusted `summarise_crt_hb_items()` to avoid `.data` in tidyselect args (names_from/values_from) to remove deprecation warning.
2025-12-12T20:50:00Z | Add raw responses to correctness tables | Updated `summarise_crt_hb_items()` to join raw CRT/HB responses to per-item correctness counts so tables show response text vs correct/incorrect/NA.
2025-12-12T21:00:00Z | Fix sanity pivot type clash | Restricted raw CRT/HB columns to response items (excluding timing) to avoid type-coercion error in `summarise_crt_hb_items()`.
2025-12-12T21:10:00Z | Coerce raw responses to character | Converted raw CRT/HB response columns to character before pivoting in `summarise_crt_hb_items()` to prevent mixed-type combine errors.
2025-12-12T21:20:00Z | Keep raw responses in sanity tables | Pointed `summarise_crt_hb_items()` at `with_timings` (which retains raw CRT/HB items) and ensured raw responses stay attached to per-item correctness counts.
2025-12-12T21:30:00Z | Use item metadata for raw joins | Updated `summarise_crt_hb_items()` to pull raw CRT/HB column names from `hb_crt_items.json` metadata and join responses to correctness counts; sanity target now passes `item_metadata`.
2025-12-12T15:45:00Z | Document prereg CSV needs | Added prereg-driven analysis requirements, CSV variable expectations, development goals, tests, and implementation plan to README; marked README documentation task done in TODO.
2025-12-12T22:15:00Z | Add agent guidance and Python correctness checker | Added `AGENTS.md` with Rscript avoidance instructions, inserted early `_targets.R` target to dump raw SAV to `outputs/raw_data_debug.csv`, created stdlib-only `tools/check_crt_correctness.py` to flag response/answer-key mismatches, and ran it (pandas-free) to surface current crt_item_correctness issues; updated TODO with current audit tasks.
2025-12-12T22:35:00Z | Fix correctness summary join | Patched `summarise_crt_hb_items()` to join raw responses to scores by row id (not item-only), preventing misaligned response labels that falsely counted incorrect answers as correct in `crt_item_correctness.csv`.
2025-12-12T22:45:00Z | Keep rowid numeric in correctness summary | Adjusted `summarise_crt_hb_items()` to avoid coercing `rowid` to character during raw-response pivot, fixing the tar_make join type error in `sanity_outputs`.
2025-12-12T23:00:00Z | Add response labels to correctness tables | Expanded `summarise_crt_hb_items()` to map raw responses to labelled options from item metadata (e.g., HB multiple-choice labels like “Das größere Krankenhaus”), and use the labelled display in correctness summaries.
2025-12-12T23:15:00Z | Distinguish seen/aid/missing in correctness tables | Updated `summarise_crt_hb_items()` to tag NA scores as `seen`, `aid_dropped`, or `missing`, and to include those statuses in the per-response counts.
2025-12-12T23:30:00Z | Add item text to correctness outputs | Added item stem text to per-item correctness summaries (CRT/HB) via metadata lookup so tables show the question alongside responses/status.
2025-12-12T23:45:00Z | Simplify correctness statuses | Removed aid flag dependency from correctness tables (counts now just correct/incorrect/seen/missing) to avoid missing column errors and keep the table focused on scoring logic.
2025-12-12T23:55:00Z | Outcome-bias pair summary | Added `hb_outcome_pair_correctness.csv` generation summarizing HB_13 vs HB_14 response combinations with correctness counts using labelled responses.
2025-12-13T00:05:00Z | Expand CRT accepted answers | Added ad-hoc accepted labels for CRT_6_4 (\"Emilys\") and CRT_8_4 variants (\"das streichholz\", \"sreichholz\", \"szreochholz\") so these observed responses score as correct.
2025-12-13T00:15:00Z | Silence tidyselect deprecation | Replaced `.data` pronouns in tidyselect contexts inside `summarise_crt_hb_items()` to stop tidyselect 1.2.0 deprecation warnings during tar_make.
2025-12-13T00:25:00Z | Silence sanity plot warnings | Filtered non-finite values before histograms and set ggsave to png/cairo in make_sanity_outputs() to avoid display and non-finite warnings during tar_make.
2025-12-13T00:40:00Z | Add correctness golden-master tests | Copied sanity correctness CSVs to tests/golden_master/ and added tests to assert current outputs match the golden versions for CRT, HB, and HB outcome-pair tables.
2025-12-13T00:50:00Z | Add CTSQ-prefixed exports and demo fields | prepare_analysis_export now retains CTSQ_AOT/PIT/CMT/PET av & z columns (aliases from existing means), keeps original means, and tests assert these plus demo_* fields are present.
2025-12-13T01:00:00Z | Drop unprefixed CTSQ means from export | Updated prepare_analysis_export to keep only CTSQ_* av/z columns (drop AOT_Mean etc.) and aligned tests to require CTSQ-prefixed fields and ensure unprefixed means are absent.
2025-12-13T01:10:00Z | Remove redundant CTSQ aliases | prepare_analysis_export now maps directly from ctsq_* to CTSQ_* exports (no AOT_Mean intermediates), keeping the pipeline leaner; tests unchanged.
2025-12-13T01:30:00Z | Add CRT/HB performance plots | Added APA-themed plotting helper and targets to emit distribution, item-accuracy, scatter, and speed–accuracy PNGs; included test coverage and TODO reminder to rerun tar_make.
2025-12-13T02:00:00Z | Align prereg columns to CTSQ names | Switched export validation and sanity plots to require/use `CTSQ_<subscale>_z` columns, updated tests and README to match, and ensured raw CTSQ item fields remain dropped.
